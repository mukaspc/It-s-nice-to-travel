---
import Layout from "../../../layouts/Layout.astro";
import PlansContainer from "../../../components/plans/PlansContainer.astro";
import { PlanFormWrapper } from "../../../components/plans/PlanFormWrapper";
import type { PlanDTO } from "../../../types";

const { id } = Astro.params;

let plan: PlanDTO | undefined;
let error: string | undefined;

try {
  const response = await fetch(`${Astro.url.origin}/api/plans/${id}`);
  if (!response.ok) {
    throw new Error("Failed to fetch plan");
  }
  plan = await response.json();
} catch (err) {
  error = err instanceof Error ? err.message : "Failed to load plan";
  console.error("Error fetching plan:", err);
}
---

<Layout title={plan ? `Edit ${plan.name}` : "Edit Travel Plan"}>
  <PlansContainer>
    <div class="space-y-6">
      <h1 class="text-3xl font-bold">{plan ? `Edit ${plan.name}` : "Edit Travel Plan"}</h1>
      {error && <div class="bg-destructive/15 text-destructive p-4 rounded-md">{error}</div>}
      {!error && <PlanFormWrapper client:load mode="edit" initialData={plan} />}
    </div>
  </PlansContainer>
</Layout> 